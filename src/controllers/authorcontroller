
const { count } = require("console")
const BookModel= require("../models/bookModel")
const authorModel1= require("../models/authormodel.js")
const authormodel = require("../models/authormodel.js")

const createBooks= async function (req, res) {
    let data= req.body

    let savedData= await BookModel.create(data)
    res.send({msg: savedData})
}

const createAuthor= async function (req, res) {
    let data = req.body;
    let savedData= await  authorModel1.create(data);
    res.send({msg:savedData});
}

const authorAllBooks=async function(req,res){
    let authors = await authorModel1.find({author_name:"chetan Bhagat"})
    let bookid = await BookModel.find({author_id :{$eq:authors[0].author_id}})
    res.send({msg:bookid})
}
const findauthor =async function(req,res){
    let bookprice= await BookModel.findOneAndUpdate({name:"Two states"},{$set:{price:100}},{new:true})
    let updateprice = bookprice.price;
    let authorupdate = await authormodel.find({author_id:{$eq :bookprice.author_id}}).select({author_name:1,_id:0})
    
    res.send({msg:authorupdate,updateprice})
}
const findBooks = async function(req,res){
    let allBooks = await BookModel.find({price:{$gte:50,$lte:100}})
    let store = allBooks.map(x=>x.author_id);
    let NewBooks = await authormodel.find({author_id:store}).select({author_name:1,_id:0})
    res.send(NewBooks)
}





module.exports.createBooks= createBooks
module.exports.createAuthor=createAuthor
module.exports.authorAllBooks=authorAllBooks
module.exports.findauthor=findauthor
module.exports.findBooks=findBooks